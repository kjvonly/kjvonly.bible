<script lang="ts">
	import BookChapterPopup from './bookChapterPopup.svelte';
	import ActionDropdown from './actionsPopup.svelte';
	import SettingsPopup from './settingsPopup.svelte';
	import NotesContainer from '../notes/notesContainer.svelte';
	import CopyVersePopup from './copyVersePopup.svelte';

	let {
		mode = $bindable(),
		annotations = $bindable(),
		chapterKey = $bindable(),
		bookName,
		bookChapter,
		containerHeight,
		paneId
	} = $props();

	let showBookChapterPopup: Boolean = $state(false);
	let showSettingsPopup: Boolean = $state(false);
	let showActionsPopup: Boolean = $state(false);
	let showCopyVersePopup: boolean  = $state(false)

	function onBookChapterClick(event: Event) {
		event.stopPropagation();
		showBookChapterPopup = !showBookChapterPopup;
	}

	function onSettingsClick(event: Event) {
		event.stopPropagation();
		showSettingsPopup = !showSettingsPopup;
	}

	function onActionClick(e: Event) {
		e.stopPropagation();
		showActionsPopup = !showActionsPopup;
	}

	let clientWidth: number = $state(0);
</script>

<!-- book chapter selection -->

<div bind:clientWidth class="leading-tight">
	<!-- svelte-ignore a11y_click_events_have_key_events -->
	<!-- svelte-ignore a11y_no_static_element_interactions -->
	<span
		class="flex items-center
		justify-between rounded-e-full rounded-s-full bg-neutral-100 px-1 text-neutral-700 hover:cursor-pointer"
	>
		<span
			onclick={(e) => {
				onSettingsClick(e);
			}}
			class="p-1"
		>
			<svg
				fill="fill-neutral-700"
				class="ml-2 h-5 w-5"
				version="1.1"
				viewBox="0 0 101.19472 102.47694"
				xmlns="http://www.w3.org/2000/svg"
			>
				<defs id="defs6" />
				<g id="g8" transform="translate(-14.22569,-5.0803528)">
					<path
						class="fill-neutral-700"
						d="m 63.982806,107.25953 c -1.14748,-0.60402 -2.237679,-2.85538 -3.122006,-6.44723 -0.262172,-1.064862 -0.615964,-2.209132 -0.786202,-2.542822 -0.722372,-1.41597 -2.022094,-2.03216 -5.546573,-2.62961 -3.911473,-0.66305 -5.328164,-0.32474 -7.044869,1.68235 -2.778907,3.248982 -4.030012,4.203262 -5.510636,4.203262 -1.778664,0 -3.90234,-2.303562 -3.908432,-4.239492 -0.0027,-0.84855 0.357058,-2.38479 1.195396,-5.105013 1.121996,-3.64063 0.869387,-4.542175 -2.102324,-7.503106 -2.227249,-2.219168 -3.004278,-2.635636 -4.686809,-2.51201 -0.734968,0.054 -2.097847,0.372904 -3.623854,0.847948 -3.014557,0.938429 -4.410573,1.09351 -5.501123,0.611108 -0.979475,-0.433269 -2.14127,-1.513992 -2.562102,-2.383316 -0.906057,-1.871663 -0.137354,-3.223692 3.804254,-6.691093 2.133077,-1.876451 2.441682,-3.149332 1.744788,-7.196584 C 25.821745,64.38876 25.53018,63.545258 24.710684,62.662512 24.059658,61.96124 23.521355,61.742128 20.817817,61.077958 17.949394,60.373281 16.541488,59.769371 15.474754,58.78609 14.53596,57.920739 14.22569,57.337997 14.22569,56.440127 c 0,-0.89787 0.31027,-1.480613 1.249064,-2.345963 1.06683,-0.983368 2.459904,-1.580358 5.335753,-2.286587 3.379879,-0.830006 3.921228,-1.145018 4.62278,-2.689996 0.530115,-1.167435 1.061246,-3.930394 1.166357,-6.067422 0.08301,-1.687714 0.06114,-1.874108 -0.316669,-2.699362 -0.300831,-0.657102 -0.738913,-1.179485 -1.693132,-2.01895 -3.188718,-2.805238 -4.140799,-4.040401 -4.140799,-5.371974 0,-1.325594 1.312113,-3.003759 2.896553,-3.704631 1.06896,-0.472852 2.480515,-0.316826 5.507395,0.608764 4.558113,1.393826 5.140517,1.263245 8.254522,-1.850759 2.37756,-2.37756 2.84151,-3.221122 2.694494,-4.899171 -0.05199,-0.593474 -0.352008,-1.886179 -0.666694,-2.872675 -1.135537,-3.559749 -1.301773,-4.868218 -0.767833,-6.043781 0.704298,-1.55064 2.342954,-2.842844 3.605039,-2.842844 1.484819,0 2.602211,0.847605 5.430989,4.119712 0.520752,0.602365 1.291197,1.297648 1.712102,1.545073 0.717891,0.422008 0.881397,0.449488 2.64044,0.443773 2.324186,-0.0076 5.209755,-0.537893 6.603821,-1.213723 1.525845,-0.739714 1.789501,-1.246401 2.740935,-5.267476 0.943471,-3.9874086 3.00303,-6.3778136 5.01617,-5.8219586 1.836813,0.507168 3.21401,2.721696 4.079381,6.5596326 0.263826,1.17007 0.612995,2.428769 0.77593,2.797108 0.648391,1.465775 1.974128,2.114176 5.568476,2.723469 2.505055,0.424642 4.315899,0.374773 5.326242,-0.14668 0.373508,-0.192773 1.180642,-0.920856 1.79363,-1.617962 2.818373,-3.205126 4.021131,-4.120968 5.41199,-4.120968 0.919156,0 1.742925,0.44623 2.68701,1.455533 1.629727,1.74231 1.657819,2.857621 0.18923,7.51262 -0.747362,2.368918 -0.888987,3.780107 -0.486516,4.847743 0.419653,1.113213 4.225647,4.920861 5.33775,5.340069 1.079386,0.406875 2.531258,0.270642 4.85149,-0.455227 4.65881,-1.457477 5.75516,-1.44153 7.451,0.108376 2.27789,2.081864 2.04704,3.922536 -0.81633,6.508756 -2.93367,2.649724 -3.33098,3.10218 -3.63132,4.135284 -0.34449,1.185016 -0.2419,3.067127 0.31447,5.76944 0.74413,3.614206 1.43786,4.287057 5.5483,5.381351 4.14478,1.103437 4.9027,1.796228 4.9027,4.481406 0,2.677682 -0.76125,3.376858 -4.88219,4.484076 -3.14985,0.846302 -4.10375,1.40739 -4.84747,2.851292 -0.44393,0.86189 -1.08511,4.018853 -1.21152,5.965242 -0.17581,2.706882 0.0286,3.054199 3.80703,6.466872 2.87727,2.59878 3.09653,4.424782 0.78499,6.537402 -1.59165,1.454676 -2.81596,1.500337 -6.84896,0.255437 -2.90743,-0.897463 -4.288729,-1.058191 -5.42219,-0.630934 -1.112103,0.419207 -4.918097,4.226855 -5.33775,5.340069 -0.402471,1.067635 -0.260846,2.478825 0.486516,4.847741 1.103006,3.496204 1.302704,4.975194 0.825864,6.116434 -0.311394,0.74527 -1.643088,2.152672 -2.404349,2.541042 -0.334939,0.17087 -0.91893,0.31068 -1.297755,0.31068 -1.390859,0 -2.593617,-0.91584 -5.41199,-4.120972 -0.612988,-0.6971 -1.420122,-1.42467 -1.79363,-1.61682 -1.001784,-0.51535 -2.681172,-0.56163 -5.244713,-0.14452 -3.667999,0.59683 -4.994298,1.23785 -5.655971,2.73366 -0.166218,0.37575 -0.48371,1.51308 -0.705538,2.527392 -1.037182,4.74249 -3.878214,7.61852 -6.277978,6.35531 z m 7.993353,-17.713094 c 4.144861,-0.486083 6.632164,-1.428238 11.413013,-4.323091 5.141981,-3.113523 7.168641,-5.213226 7.172929,-7.431458 0.0043,-2.197887 -2.085681,-4.33093 -7.474034,-7.628213 -5.291126,-3.237787 -6.088434,-3.390525 -10.216093,-1.95705 -5.926635,2.05823 -5.380171,1.91593 -7.337579,1.910719 -1.93847,-0.0052 -1.93193,-0.0035 -7.134696,-1.847515 -3.862128,-1.368879 -4.991232,-1.145023 -10.377449,2.057436 -3.398757,2.020784 -6.460222,4.495769 -7.333922,5.928977 -0.472483,0.775057 -0.456442,1.956001 0.04091,3.011911 1.012848,2.150333 4.090554,4.559522 9.156246,7.167387 3.291923,1.694714 6.502641,2.583688 11.166182,3.091658 2.80485,0.305516 8.399392,0.315368 10.924492,0.01924 z M 37.656839,68.039389 c 1.355691,-0.361043 3.920521,-1.523092 6.598575,-2.98962 4.032435,-2.208199 5.484112,-3.406186 6.307884,-5.205538 0.22473,-0.49088 0.621405,-1.933008 0.881497,-3.204732 0.591527,-2.892275 0.824469,-3.615524 1.705021,-5.293811 0.950202,-1.811036 1.769491,-2.837367 4.263743,-5.34123 2.313551,-2.322463 3.026728,-3.254698 3.482968,-4.552781 0.571792,-1.626849 0.660562,-2.893925 0.75772,-10.815371 l 0.09649,-7.867516 h -0.339422 c -0.621834,0 -5.88198,1.139463 -7.238808,1.568085 -2.890802,0.913204 -5.961537,2.509155 -8.619021,4.47956 -1.671606,1.23942 -4.401683,3.865859 -5.747617,5.529425 -3.861948,4.77335 -6.407652,10.68216 -7.205389,16.724365 -0.540912,4.096972 -0.462199,11.955805 0.142295,14.20693 0.320899,1.195026 0.902914,2.175927 1.549487,2.611439 0.654278,0.440699 2.0424,0.502914 3.364573,0.150795 z m 58.332967,0.04953 c 1.367161,-0.379663 2.24031,-1.713121 2.659262,-4.061178 0.267387,-1.498611 0.303148,-7.763813 0.06239,-10.930291 -1.00267,-13.187003 -9.585256,-24.661997 -21.403455,-28.616614 -1.457909,-0.487848 -6.864922,-1.712048 -7.56172,-1.712048 -0.177475,0 -0.216979,1.373825 -0.216979,7.545678 0,7.822094 0.107743,9.631686 0.661607,11.112023 0.5096,1.362025 1.133204,2.16648 3.624709,4.675894 3.772031,3.79915 4.880349,5.773485 5.808855,10.347778 0.977855,4.817408 2.014184,5.95074 8.585389,9.388992 3.845655,2.012164 6.192133,2.690705 7.779947,2.249766 z"
					/>
				</g>
			</svg>
		</span>
		<span class="ml-2 h-[100%] border-s-2 border-neutral-300">&nbsp;</span>
		<span
			onclick={(e) => {
				onBookChapterClick(e);
			}}
			class="m-0 text-center font-bold text-neutral-700 md:text-base lg:text-lg"
		>
			<span class="bookChapter flex items-center text-center"
				><span>{bookName} {bookChapter}</span><span> </span></span
			>
		</span>
		<span class="mr-2 h-[100%] border-e-2 border-neutral-300">&nbsp;</span>

		<span onclick={onActionClick}>
			<svg
				fill="fill-neutral-700"
				class="mr-2 h-5 w-5"
				viewBox="0 0 25.4 14.098638"
				version="1.1"
				id="svg5"
				xml:space="preserve"
				xmlns="http://www.w3.org/2000/svg"
				><defs id="defs2" /><g id="layer1" transform="translate(-53.644677,-127.79211)"
					><path
						class="fill-neutral-700"
						d="m 59.906487,137.65245 -6.26181,-4.21622 v -2.82206 -2.82206 l 6.35,4.24282 6.35,4.24283 6.35,-4.24283 6.35,-4.24282 v 2.82222 2.82222 l -6.3429,4.23808 c -3.48859,2.33094 -6.38578,4.22817 -6.43819,4.21606 -0.0524,-0.0121 -2.91311,-1.91931 -6.3571,-4.23824 z"
						id="path179"
					/></g
				></svg
			>
		</span>
	</span>
	<div></div>
</div>

{#if showBookChapterPopup}
	<div style={containerHeight} class="absolute z-[10000] w-full shadow-lg">
		<BookChapterPopup bind:showBookChapterPopup bind:chapterKey></BookChapterPopup>
	</div>
{/if}
{#if showSettingsPopup}
	<div style={containerHeight} class="absolute z-[10000] w-full shadow-lg">
		<SettingsPopup bind:showSettingsPopup></SettingsPopup>
	</div>
{/if}

{#if showActionsPopup}
	<div style={containerHeight} class="absolute z-[10000] w-full shadow-lg">
		<ActionDropdown {paneId} bind:showCopyVersePopup bind:showActionsDropdown={showActionsPopup}></ActionDropdown>
	</div>
{/if}

{#if mode.notePopup.show}
	<div style={containerHeight} class="absolute z-[10000] w-full shadow-lg">
		<NotesContainer containerHeight bind:mode bind:annotations></NotesContainer>
	</div>
{/if}

{#if showCopyVersePopup}
	<div style={containerHeight} class="absolute z-[10000] w-full shadow-lg">
		<CopyVersePopup bind:showCopyVersePopup {chapterKey}></CopyVersePopup>
	</div>
{/if}

<style>
	@reference "../../../app.css";
	.bookChapter {
		font-size: min(5cqw, 1rem);
	}
</style>
